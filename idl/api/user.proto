syntax = "proto3";

package user;

option go_package = "/api/user";

import "api.proto";
import "model.proto";

message User {
    string id = 1;
    string username = 2;
    string password = 3;
    string avatarUrl = 4;
    string createdAt = 5;
    string updatedAt = 6;
    string deletedAt = 7;
}

message LoginRequest {
    string username = 1[(api.body)="username"];
    string password = 2[(api.body)="password"];
    string code = 3[(api.body)="code"];
}

message Token {
    string accessToken = 1;
    string accessExpireTime = 2;
    string refreshToken = 3;
    string refreshExpireTime = 4;
}

message UserWithToken {
    User user = 1;
    Token token = 2;
}

message LoginResponse {
    model.BaseResp base = 1;
    UserWithToken data = 2;
}

message RegisterRequest {
    string username = 1[(api.body)="username"];
    string password = 2[(api.body)="password"];
}

message RegisterResponse {
    model.BaseResp base = 1;
}

message GetUserInfoRequest {
    string userId = 1[(api.query)="userId"];
}

message GetUserInfoResponse {
    model.BaseResp base = 1;
    User data = 2;
}

message UploadAvatarRequest {
    string data = 1[(api.body)="data"];
}

message UploadAvatarResponse {
    model.BaseResp base = 1;
    User data = 2;
}

message MFA {
    string secret = 1;
    string qrcode = 2;
}

message GetMFARequest {}

message GetMFAResponse {
    model.BaseResp base = 1;
    MFA data = 2;
}

message BindMFARequest {
    string code = 1[(api.body)="code"];
    string secret = 2[(api.body)="secret"];
}

message BindMFAResponse {
    model.BaseResp base = 1;
}

message SearchImgRequest {
    string data = 1[(api.body)="data"];
}

message SearchImgResponse {
    model.BaseResp base = 1;
    string data = 2;
}

message RefreshRequest {}

message RefreshResponse {
    model.BaseResp base = 1;
    Token data = 2;
}

service UserService {
    rpc Login(LoginRequest) returns (LoginResponse) {
        option (api.post)="/user/login";
    }
    rpc Register(RegisterRequest) returns (RegisterResponse) {
        option (api.post)="/user/register";
    }
    rpc GetUserInfo(GetUserInfoRequest) returns (GetUserInfoResponse) {
        option (api.get)="/user/info";
    }
    rpc UploadAvatar(UploadAvatarRequest) returns (UploadAvatarResponse) {
        option (api.put)="/user/avatar/upload";
    }
    rpc GetMFA(GetMFARequest) returns (GetMFAResponse) {
        option (api.get)="/user/mfa/qrcode";
    }
    rpc BindMFA(BindMFARequest) returns (BindMFAResponse) {
        option (api.post)="user/mfa/bind";
    }
    rpc SearchImg(SearchImgRequest) returns (SearchImgResponse) {
        option (api.post)="/user/image/search";
    }
    rpc Refresh(RefreshRequest) returns (RefreshResponse) {
        option (api.get)="/refresh";
    }
}