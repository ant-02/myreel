syntax = "proto3";

package user;

option go_package = "/api/user";

import "api.proto";

message User {
    int64 id = 1;
    string username = 2;
    string password = 3;
    string avatarUrl = 4;
    string createdAt = 5;
    string updatedAt = 6;
    string deletedAt = 7;
}

message LoginRequest {
    string username = 1[(api.body)="username"];
    string password = 2[(api.body)="password"];
    string code = 3[(api.body)="code"];
}

message Token {
    string accessToken = 1;
    int64 accessExpireTime = 2;
    string refreshToken = 3;
    int64 refreshExpireTime = 4;
}

message LoginResponse {
    User user = 1;
    Token token = 2;
}

message RegisterRequest {
    string username = 1[(api.body)="username"];
    string password = 2[(api.body)="password"];
}

message RegisterResponse {}

message GetUserInfoRequest {
    int64 userId = 1[(api.query)="userId"];
}

message GetUserInfoResponse {
    User data = 1;
}

message UploadAvatarRequest {
    string data = 1[(api.body)="data"];
}

message UploadAvatarResponse {
    User data = 1;
}

message MFA {
    string secret = 1;
    string qrcode = 2;
}

message GetMFARequest {}

message GetMFAResponse {
    MFA data = 1;
}

message BindMFARequest {
    string code = 1[(api.body)="code"];
    string secret = 2[(api.body)="secret"];
}

message BindMFAResponse {}

message SearchImgRequest {
    string data = 1[(api.body)="data"];
}

message SearchImgResponse {
    string data = 1;
}

message RefreshRequest {}

message RefreshResponse {
    Token data = 1;
}

service UserService {
    rpc Login(LoginRequest) returns (LoginResponse) {
        option (api.post)="/api/v1/user/login";
    }
    rpc Register(RegisterRequest) returns (RegisterResponse) {
        option (api.post)="/api/v1/user/register";
    }
    rpc GetUserInfo(GetUserInfoRequest) returns (GetUserInfoResponse) {
        option (api.get)="/api/v1/user/info";
    }
    rpc UploadAvatar(UploadAvatarRequest) returns (UploadAvatarResponse) {
        option (api.put)="/api/v1/user/avatar/upload";
    }
    rpc GetMFA(GetMFARequest) returns (GetMFAResponse) {
        option (api.get)="/api/v1/user/mfa/qrcode";
    }
    rpc BindMFA(BindMFARequest) returns (BindMFAResponse) {
        option (api.post)="/api/v1/user/mfa/bind";
    }
    rpc SearchImg(SearchImgRequest) returns (SearchImgResponse) {
        option (api.post)="/api/v1/user/image/search";
    }
    rpc Refresh(RefreshRequest) returns (RefreshResponse) {
        option (api.get)="/api/v1/refresh";
    }
}